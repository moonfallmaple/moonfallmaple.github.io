<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo.png"/>
	<link rel="shortcut icon" href="/img/logo.png">
	
			    <title>
    月落丹枫
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_prism_okaidia.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">月落丹枫</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Category</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Data-Analysis/">Data-Analysis</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/tags/" title="Tag">
		                Tag
		            </a>
		        </li>
		        
		        <li>
		            <a href="/demo/" title="Demo">
		                Demo
		            </a>
		        </li>
		        
		        <li>
		            <a href="https://www.linkedin.com/in/jane-shan-a50170142/" title="Resume">
		                Resume
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/moonfallmaple" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height:8rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 2rem 4rem 2rem 4rem ;"><h2 >Tensorflow Exploratory</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 2rem 4rem 2rem 4rem ;">
                <h2 id="将问题构建为二元分类问题"><a href="#将问题构建为二元分类问题" class="headerlink" title="将问题构建为二元分类问题"></a>将问题构建为二元分类问题</h2><p>数据集的目标是 median_house_value，它是一个数值（连续值）特征。我们可以通过向此连续值使用阈值来创建一个布尔值标签。<br>通过某个城市街区的特征预测该街区的住房成本是否高昂。为了给训练数据和评估数据准备目标，我们针对房屋价值中位数定义了分类阈值 - 第 75 百分位数（约为 265000）。所有高于此阈值的房屋价值标记为 1，其他值标记为 0。<br><a id="more"></a></p>
<h2 id="读入数据，数据预处理"><a href="#读入数据，数据预处理" class="headerlink" title="读入数据，数据预处理"></a>读入数据，数据预处理</h2><pre><code class="bash">#读入数据
df = pd.read_csv(&quot;https://storage.googleapis.com/mledu-datasets/california_housing_train.csv&quot;, sep=&quot;,&quot;)
#将数据集序列打乱
df = df.reindex(np.random.permutation(df.index))
#在使用数据前，对数据有个大致的了解
print(df.describe())
</code></pre>
<h2 id="设置特征，特征列，目标，分配测试、验证数据"><a href="#设置特征，特征列，目标，分配测试、验证数据" class="headerlink" title="设置特征，特征列，目标，分配测试、验证数据"></a>设置特征，特征列，目标，分配测试、验证数据</h2><ul>
<li><p>特征</p>
<pre><code class="bash">def preprocess_features(df):

  selected_features = df[
          [&quot;latitude&quot;,
           &quot;longitude&quot;,
           &quot;housing_median_age&quot;,
           &quot;total_rooms&quot;,
           &quot;total_bedrooms&quot;,
           &quot;population&quot;,
           &quot;households&quot;,
           &quot;median_income&quot;]]
  processed_features = selected_features.copy()

  processed_features[&quot;rooms_per_person&quot;] = (df[&quot;total_rooms&quot;] /df[&quot;population&quot;])
  return processed_features
</code></pre>
</li>
<li><p>特征列</p>
</li>
</ul>
<pre><code class="bash">def construct_feature_columns(input_features):
    return set([tf.feature_column.numeric_column(my_feature) for my_feature in input_features])

</code></pre>
<ul>
<li>目标<pre><code class="bash">def preprocess_targets(df):
  output_targets = pd.DataFrame()
  output_targets[&#39;median_house_value_is_high&#39;] = (df[&#39;median_house_value&#39;]&gt;265000).astype(float32)
  return output_targets
</code></pre>
</li>
<li>分配测试数据<pre><code class="bash">train_x = preprocess_features(df.head(12000))
train_y = preprocess_targets(df.head(12000))
</code></pre>
</li>
<li>分配验证数据<pre><code class="bash">validation_x = preprocess_features(df.tail(3000))
validation_y = preprocess_targets(df.tail(3000))
</code></pre>
</li>
</ul>
<h2 id="定义输入函数"><a href="#定义输入函数" class="headerlink" title="定义输入函数"></a>定义输入函数</h2><pre><code class="bash">def my_input_fn(x, y, batch_size=1, shuffle=True, num_epochs=None):

    x = {key:np.array(value) for key,value in dict(x).items()}
    ds = Dataset.from_tensor_slices((x,y)) # warning: 2GB limit
    ds = ds.batch(batch_size).repeat(num_epochs)

    if shuffle:
        ds = ds.shuffle(100)

    x, labels = ds.make_one_shot_iterator().get_next()
    return x, labels
</code></pre>
<h2 id="建模"><a href="#建模" class="headerlink" title="建模"></a>建模</h2><pre><code class="bash">def train_linear_classifier_model(learning_rate, steps, batch_size, train_x, train_y, validation_x,
    validation_y):
    periods = 10
    steps_per_period = steps/periods

    my_optimizer = tf.train.AdamOptimizer(learning_rate = learning_rate)
    linear_classifier = tf.estimator.LinearClassifier(
            feature_columns=construct_feature_columns(train_x),
            optimizer=my_optimizer
            )
    train_input_fn = lambda: my_input_fn(train_x,train_y[&#39;median_house_value_is_high&#39;],
    batch_size = batch_size)
    predict_train_input_fn = lambda: my_input_fn(train_x,train_y[&#39;median_house_value_is_high&#39;],
    num_epochs=1,shuffle=False)
    predict_validation_input_fn = lambda: my_input_fn(validation_x,validation_y[&#39;median_house_value_is_high&#39;],
    num_epochs=1, shuffle=False)
    print ( &quot;Training model...&quot;)
    print (&quot;LogLoss (on training data):&quot;)

    train_log_losses = []
    validation_log_losses = [] #

    for period in range (0, periods):
        linear_classifier.train(
                input_fn=train_input_fn,
                steps=steps_per_period
                )
        training_prob = linear_classifier.predict(input_fn=predict_train_input_fn)
        training_prob = np.array([item[&#39;probabilities&#39;] for item in training_prob])
        validation_prob = linear_classifier.predict(input_fn=predict_validation_input_fn)
        validation_prob = np.array([item[&#39;probabilities&#39;] for item in validation_prob])
        train_log_loss = metrics.log_loss(train_y, training_prob)
        validation_log_loss = metrics.log_loss(validation_y, validation_prob)
    print (&quot;  period %02d : %0.2f&quot; % (period, train_log_loss))

    train_log_losses.append(train_log_loss)
    validation_log_losses.append(validation_log_loss)
    print (&quot;Model training finished.&quot;)

    plt.ylabel(&quot;LogLoss&quot;)
    plt.xlabel(&quot;Periods&quot;)
    plt.title(&quot;LogLoss vs. Periods&quot;)
    plt.tight_layout()
    plt.plot(train_log_losses, label=&quot;training&quot;)
    plt.plot(validation_log_losses, label=&quot;validation&quot;)
    plt.legend()

    return linear_classifier    
</code></pre>
<h2 id="运行分类函数"><a href="#运行分类函数" class="headerlink" title="运行分类函数"></a>运行分类函数</h2><pre><code class="bash">linear_classifier = train_linear_classifier_model(
        learning_rate=0.000005,
        steps=50,
        batch_size=20,
        train_x=train_x,
        train_y=train_y,
        validation_x=validation_x,
        validation_y=validation_y)

</code></pre>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><pre><code class="bash">predict_validation_input_fn = lambda: my_input_fn(validation_x, validation_y[&quot;median_house_value_is_high&quot;],
num_epochs=1, shuffle=False)  
evaluation_metrics = linear_classifier.evaluate(input_fn= predict_validation_input_fn)
print (&quot;AUC on the validation set: %0.2f&quot; % evaluation_metrics[&#39;auc&#39;])
print (&quot;Accuracy on the validation set: %0.2f&quot; % evaluation_metrics[&#39;accuracy&#39;])
</code></pre>
<h2 id="重要变量"><a href="#重要变量" class="headerlink" title="重要变量"></a>重要变量</h2><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th>功能</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">train_x</td>
<td>特征的训练集</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">train_y</td>
<td>标签的训练集</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">validation_x</td>
<td>特征的验证集</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">validation_y</td>
<td>目标的验证集</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">x</td>
<td>特征</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">y</td>
<td>标签</td>
<td></td>
</tr>
<tr>
<td style="text-align:left">training_prob</td>
<td>训练集预测概率</td>
<td>linear_classifier.predict(input_fn=predict_train_input_fn)</td>
</tr>
<tr>
<td style="text-align:left">validation_prob</td>
<td>验证集预测概率</td>
<td>linear_classifier.predict(input_fn=predict_validation_input_fn)</td>
</tr>
<tr>
<td style="text-align:left">train_log_loss</td>
<td>训练集对数损失函数</td>
<td>train_y, training_prob</td>
</tr>
<tr>
<td style="text-align:left">validation_log_loss</td>
<td>验证集对数损失函数</td>
<td>validation_y, validation_prob</td>
</tr>
</tbody>
</table>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><table>
<thead>
<tr>
<th>名称</th>
<th>功能</th>
<th style="text-align:center">参数</th>
</tr>
</thead>
<tbody>
<tr>
<td>preprocess_features(df)</td>
<td>设置特征</td>
<td style="text-align:center">df</td>
</tr>
<tr>
<td>construct_feature_columns(df)</td>
<td>设置特征列</td>
<td style="text-align:center">input_features</td>
</tr>
<tr>
<td>preprocess_targets(df)</td>
<td>设置目标</td>
<td style="text-align:center">df</td>
</tr>
<tr>
<td>my_input_fn</td>
<td>输入数据</td>
<td style="text-align:center">x, y, batch_size=1, shuffle=True, num_epochs=None</td>
</tr>
<tr>
<td>train_linear_classifier_model</td>
<td>分类模型</td>
<td style="text-align:center">learning_rate, steps, batch_size, train_x, train_y, validation_x, validation_y</td>
</tr>
</tbody>
</table>
<h2 id="tensorflow内置函数"><a href="#tensorflow内置函数" class="headerlink" title="tensorflow内置函数"></a>tensorflow内置函数</h2><table>
<thead>
<tr>
<th>名称</th>
<th>功能</th>
<th>属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>tf.data.Dataset.from_tensor_slices(x,y)</td>
<td>返回一个特征和标签组合而成的dataset</td>
<td>x,y</td>
</tr>
<tr>
<td>Dataset.batch(batch_size)</td>
<td>将数据拆分成batch_size份</td>
<td>batch_size</td>
</tr>
<tr>
<td>Dataset.make_one_shot_iterator()</td>
<td>返回一个元素迭代器</td>
<td></td>
</tr>
<tr>
<td>get_next()</td>
<td>表示从iterator里取出下一个元素</td>
<td></td>
</tr>
<tr>
<td>tf.feature_column.numeric_column</td>
<td>设置特征列</td>
<td>my_feature</td>
</tr>
<tr>
<td>tf.train.AdamOptimizer</td>
<td>配置Adam优化器</td>
<td>learning_rate</td>
</tr>
<tr>
<td>tf.train.GradientDescentOptimizer</td>
<td>配置梯度下降优化器</td>
<td>learning_rate</td>
</tr>
<tr>
<td>tf.estimator.LinearClassifier</td>
<td>线性分类器</td>
<td>feature_columns, optimizer</td>
</tr>
<tr>
<td>tf.estimator.LinearClassifier.train</td>
<td>训练</td>
<td>input_fn = training_input_fn, steps</td>
</tr>
<tr>
<td>tf.estimator.LinearClassifier.predict</td>
<td>预测</td>
<td>input_fn = predict_training_input_fn, steps</td>
</tr>
<tr>
<td>tf.estimator.LinearClassifier.evaluate</td>
<td>验证</td>
<td>input_fn= predict_validation_input_fn</td>
</tr>
</tbody>
</table>
<ul>
<li>例子<br><code>`</code> bash<br>my_optimizer = tf.train.AdamOptimizer(learning_rate = learning_rate)<br>linear_classifier = tf.estimator.LinearClassifier(<br>  feature_columns=construct_feature_columns(train_x),<br>  optimizer=my_optimizer<br>)</li>
</ul>
<p>linear_classifier.train(<br>    input_fn=training_input_fn,<br>    steps=steps_per_period<br>)</p>
<p>training_probabilities = linear_classifier.predict(input_fn=predict_train_input_fn)<br>evaluation_metrics = linear_classifier.evaluate(input_fn= predict_validation_input_fn)</p>
<p><code>`</code></p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 valine -->
<div id="comment">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#comment' ,
        notify: true,
        verify: false,
        app_id: '5ieD2qBIigoLuVa78tzFJ22P-gzGzoHsz',
        app_key: '6TREdEvvBJpk2ElJDUL27w5U',
        placeholder: 'Please leave your footprints',
        pageSize: '10',
        avatar: '',
        avatar_cdn: 'https://gravatar.loli.net/avatar/'
    });
</script>
</div>
<style>
   #comment{
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
