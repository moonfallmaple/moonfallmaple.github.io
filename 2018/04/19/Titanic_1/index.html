<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo.png"/>
	<link rel="shortcut icon" href="/img/logo.png">
	
			    <title>
    月落丹枫
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

			    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">月落丹枫</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Home</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Category</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Data-Analysis/">Data-Analysis</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/tags/" title="Tag">
		                Tag
		            </a>
		        </li>
		        
		        <li>
		            <a href="/demo/" title="Demo">
		                Demo
		            </a>
		        </li>
		        
		        <li>
		            <a href="https://www.linkedin.com/in/jane-shan-a50170142/" title="Resume">
		                Resume
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/moonfallmaple" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height:8rem;background-image: url();background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 2rem 4rem 2rem 4rem ;"><h2 >Titanic(1)</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 2rem 4rem 2rem 4rem ;">
                <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>1 摘要</li>
<li>2 导入库</li>
<li>3 特征预处理</li>
<li>4 特征转化</li>
<li>5 模型选择</li>
<li>6 预测并提交</li>
<li>7 填补缺失值的其他方法<a id="more"></a>
</li>
</ul>
<h2 id="1-摘要"><a href="#1-摘要" class="headerlink" title="1.摘要"></a>1.摘要</h2><p>对于Titanic问题，计划分两篇记录。一篇用单一模型，另一篇用集成模型。本文是对Titanic问题使用单一模型的试验结果记录。内容分三个阶段，1）特征预处理：包括处理数据缺失以及展示特征对目标的影响程度。2）特征转化：将特征值转化为数值型变量。3）模型选择：这里会挑选10个分类模型对数据做训练，并给出每个模型的打分。最终，选用打分最高的模型来训练并分类数据。本文提交以后在Kaggle上的排名为Top7%。</p>
<h2 id="2-导入库"><a href="#2-导入库" class="headerlink" title="2.导入库"></a>2.导入库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据预处理</span></span><br><span class="line">import pandas as pd</span><br><span class="line">import numpy as np</span><br><span class="line">import random as rnd</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可视化</span></span><br><span class="line">import seaborn as sns</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"><span class="comment">#模型</span></span><br><span class="line">from sklearn.linear_model import LogisticRegression</span><br><span class="line">from sklearn.naive_bayes import GaussianNB</span><br><span class="line">from sklearn.neighbors import KNeighborsClassifier</span><br><span class="line">from sklearn.svm import SVC</span><br><span class="line">from sklearn.tree import DecisionTreeClassifier</span><br><span class="line">from sklearn.ensemble import RandomForestClassifier, AdaBoostClassifier, GradientBoostingClassifier</span><br><span class="line">from sklearn.discriminant_analysis import LinearDiscriminantAnalysis, QuadraticDiscriminantAnalysis</span><br><span class="line"></span><br><span class="line"><span class="comment">#其他</span></span><br><span class="line">from sklearn.model_selection import StratifiedShuffleSplit</span><br><span class="line">from sklearn.metrics import accuracy_score, log_loss</span><br></pre></td></tr></table></figure>
<h2 id="3-特征预处理"><a href="#3-特征预处理" class="headerlink" title="3.特征预处理"></a>3.特征预处理</h2><h3 id="3-1-导入数据"><a href="#3-1-导入数据" class="headerlink" title="3.1 导入数据"></a>3.1 导入数据</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#导入训练与测试数据</span></span><br><span class="line">train=pd.read_csv(<span class="string">'train.csv'</span>)</span><br><span class="line"><span class="built_in">test</span>=pd.read_csv(<span class="string">'test.csv'</span>)</span><br><span class="line">full_data = [train, <span class="built_in">test</span>]</span><br><span class="line">PassengerId=<span class="built_in">test</span>[<span class="string">'PassengerId'</span>]</span><br><span class="line"><span class="comment">#一开始没把乘客ID单独保存的后果是，最后在提交文件的时候会显示没有这一列，因为在特征选择时已经将这一列drop。</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-特征分析"><a href="#3-2-特征分析" class="headerlink" title="3.2 特征分析"></a>3.2 特征分析</h3><p>在对特征进行逐一分析时，会涉及到以下几个步骤：</p>
<p>3.2.1统计缺失值 （full_data）<br>3.2.2 缺失数据处理 （full_data）<br>3.2.3合并特征  （full_data）<br>3.2.4提取新特征 （full_data）<br>3.2.5分析对目标影响 （train）</p>
<p>因为了解数据的缺失情况是针对所有特征的，所以缺失统计放在第一步。统计如下：<br>| 特征  |  训练  | 测试|<br>| :——- | —-:—- |—-:—-|<br>| Age| 177 |86|<br>| Fare| 0 |1|<br>| Cabin| 687 |327|<br>| Embarked|2  |0|</p>
<p>这里不再复述如何检测缺失值，以及如何查看数据了。只是列举了以下代码共参考。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.单独缺失（训练，测试）</span></span><br><span class="line">train.isnull().sum()</span><br><span class="line">test.isnull().sum()</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.合并缺失（训练+测试）</span></span><br><span class="line">dataset =  pd.concat(objs=[train, <span class="built_in">test</span>], axis=0).reset_index(drop=True)</span><br><span class="line"><span class="comment">#检查缺失值的数量</span></span><br><span class="line">dataset.isnull().sum()</span><br></pre></td></tr></table></figure>
<p>然后，根据总结的步骤做如下分析：</p>
<p>1.Pclass：头等舱的生还率最高<br>由于仓位不含缺失数据，所以只要分析一下它对目标的影响程度<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>( train[[<span class="string">'Pclass'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'Pclass'</span>], as_index=False).mean() )</span><br><span class="line"></span><br><span class="line">Pclass  Survived</span><br><span class="line">0       1  0.629630</span><br><span class="line">1       2  0.472826</span><br><span class="line">2       3  0.242363</span><br></pre></td></tr></table></figure></p>
<p>2.名字：<br>一般特征方差为0的，表示每一个sample内容都是一样的，可以直接删除。而特征方差很高的，每个都不一样的（如同姓名）也可以删除。但是，如身份证号码这样，虽然每个都不一样，但却蕴含规律的，便可以提取新的特征。同样，姓名特征本是非常具体的，每个人都有自己的名字，很难总结出什么共同点来，但在titanic的数据中，我们可以观察到每个名字和姓之间都包含了title，而这些title是可以归纳为可数的几个类型的，那么就可以提取新的特征。我个人的理解是在分类问题中，特征最好是有清晰的类型的。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">def get_title(name):</span><br><span class="line">    title_search = re.search(<span class="string">' ([A-Za-z]+)\.'</span>, name)</span><br><span class="line"><span class="comment"># If the title exists, extract and return it.</span></span><br><span class="line">    <span class="keyword">if</span> title_search:</span><br><span class="line">        <span class="built_in">return</span> title_search.group(1)</span><br><span class="line">    <span class="built_in">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Name'</span>].apply(get_title)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.crosstab(train[<span class="string">'Title'</span>], train[<span class="string">'Sex'</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].replace([<span class="string">'Lady'</span>, <span class="string">'Countess'</span>,<span class="string">'Capt'</span>, <span class="string">'Col'</span>,<span class="string">'Don'</span>, <span class="string">'Dr'</span>,</span><br><span class="line">    <span class="string">'Major'</span>, <span class="string">'Rev'</span>, <span class="string">'Sir'</span>, <span class="string">'Jonkheer'</span>, <span class="string">'Dona'</span>], <span class="string">'Rare'</span>)</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].replace(<span class="string">'Mlle'</span>, <span class="string">'Miss'</span>)</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].replace(<span class="string">'Ms'</span>, <span class="string">'Miss'</span>)</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].replace(<span class="string">'Mme'</span>, <span class="string">'Mrs'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (train[[<span class="string">'Title'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'Title'</span>], as_index=False).mean())</span><br><span class="line">-----------------------------------------------</span><br><span class="line">Sex       female  male</span><br><span class="line">Title                 </span><br><span class="line">Capt           0     1</span><br><span class="line">Col            0     2</span><br><span class="line">Countess       1     0</span><br><span class="line">Don            0     1</span><br><span class="line">Dr             1     6</span><br><span class="line">Jonkheer       0     1</span><br><span class="line">Lady           1     0</span><br><span class="line">Major          0     2</span><br><span class="line">Master         0    40</span><br><span class="line">Miss         182     0</span><br><span class="line">Mlle           2     0</span><br><span class="line">Mme            1     0</span><br><span class="line">Mr             0   517</span><br><span class="line">Mrs          125     0</span><br><span class="line">Ms             1     0</span><br><span class="line">Rev            0     6</span><br><span class="line">Sir            0     1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Title  Survived</span><br><span class="line">0  Master  0.575000</span><br><span class="line">1    Miss  0.702703</span><br><span class="line">2      Mr  0.156673</span><br><span class="line">3     Mrs  0.793651</span><br><span class="line">4    Rare  0.347826</span><br></pre></td></tr></table></figure>
<p>3.年龄<br>首先填补年龄的缺失数据，这里参照的是构建一个以年龄的均值为中心+1个标准差和-1个标准差的区间，然后再随机取其中的数去填补缺失值。<br>这里生成的一个新的特征‘CategoricalAge’是为了将年龄特征里的特征值做一个区间化。我个人的理解是这就相当于人的归纳能力。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    age_avg  = dataset[<span class="string">'Age'</span>].mean()</span><br><span class="line">    age_std  = dataset[<span class="string">'Age'</span>].std()</span><br><span class="line">    age_null_count = dataset[<span class="string">'Age'</span>].isnull().sum()</span><br><span class="line"></span><br><span class="line">    age_null_random_list = np.random.randint(age_avg - age_std, age_avg + age_std, size=age_null_count)</span><br><span class="line">    dataset[<span class="string">'Age'</span>][np.isnan(dataset[<span class="string">'Age'</span>])] = age_null_random_list</span><br><span class="line">    dataset[<span class="string">'Age'</span>] = dataset[<span class="string">'Age'</span>].astype(int)</span><br><span class="line"></span><br><span class="line">train[<span class="string">'CategoricalAge'</span>] = pd.cut(train[<span class="string">'Age'</span>], 5)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (train[[<span class="string">'CategoricalAge'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalAge'</span>], as_index=False).mean())</span><br><span class="line">------------------------------</span><br><span class="line">CategoricalAge  Survived</span><br><span class="line">0  (-0.08, 16.0]  0.517544</span><br><span class="line">1   (16.0, 32.0]  0.350877</span><br><span class="line">2   (32.0, 48.0]  0.381743</span><br><span class="line">3   (48.0, 64.0]  0.434783</span><br><span class="line">4   (64.0, 80.0]  0.090909</span><br></pre></td></tr></table></figure></p>
<p>4.性别：女士优先，获救的女性占女性总数为74%，而男性只有18%<br>性别不含缺失数据，所以只要分析一下它对目标的影响程度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(train[[&apos;Sex&apos;, &apos;Survived&apos;]].groupby([&apos;Sex&apos;], as_index=False).mean() )</span><br><span class="line"></span><br><span class="line">Sex  Survived</span><br><span class="line">0  female  0.742038</span><br><span class="line">1    male  0.188908</span><br></pre></td></tr></table></figure></p>
<p>5.家人数<br>‘SibSp’和’Parch’可以合并成一个新特征，家人数。进而又可以知道一个人的旅行和多人一起旅行的生存机率的不同。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'FamilySize'</span>]=dataset[<span class="string">'SibSp'</span>]+dataset[<span class="string">'Parch'</span>]+1</span><br><span class="line"><span class="built_in">print</span>( train[[<span class="string">'FamilySize'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'FamilySize'</span>], as_index=False).mean() )</span><br><span class="line"></span><br><span class="line">FamilySize  Survived</span><br><span class="line">0           1  0.303538</span><br><span class="line">1           2  0.552795</span><br><span class="line">2           3  0.578431</span><br><span class="line">3           4  0.724138</span><br><span class="line">4           5  0.200000</span><br><span class="line">5           6  0.136364</span><br><span class="line">6           7  0.333333</span><br><span class="line">7           8  0.000000</span><br><span class="line">8          11  0.000000</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'IsAlone'</span>] = 0</span><br><span class="line">    dataset.loc[dataset[<span class="string">'FamilySize'</span>] == 1, <span class="string">'IsAlone'</span>] = 1</span><br><span class="line"><span class="built_in">print</span> (train[[<span class="string">'IsAlone'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'IsAlone'</span>], as_index=False).mean())</span><br><span class="line"></span><br><span class="line">IsAlone  Survived</span><br><span class="line">0        0  0.505650</span><br><span class="line">1        1  0.303538</span><br></pre></td></tr></table></figure>
<p>6.票价<br>以中位数填补票价的缺失值。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> dateset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'Fare'</span>]=dataset[<span class="string">'Fare'</span>].fillna(dataset[<span class="string">'Fare'</span>].median())</span><br><span class="line"></span><br><span class="line">    <span class="comment">#对于像票价，年龄这种类别型较多的特征在分类问题中最好对数值做区间分段，以便分类。</span></span><br><span class="line">    <span class="comment">#一般对train分类就可以得到大致的分段区间</span></span><br><span class="line">train[<span class="string">'CategoricalFare'</span>] = pd.qcut(train[<span class="string">'Fare'</span>], 4) <span class="comment">#qcut是根据这些值的频率来选择箱子的均匀间隔。</span></span><br><span class="line"><span class="built_in">print</span>( train[[<span class="string">'CategoricalFare'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'CategoricalFare'</span>], as_index=False).mean() )</span><br><span class="line"></span><br><span class="line">CategoricalFare  Survived</span><br><span class="line">0   (-0.001, 7.91]  0.197309</span><br><span class="line">1   (7.91, 14.454]  0.303571</span><br><span class="line">2   (14.454, 31.0]  0.454955</span><br><span class="line">3  (31.0, 512.329]  0.581081</span><br></pre></td></tr></table></figure></p>
<p>7.登船港口<br>以众数’S’填补缺失<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">train[<span class="string">'Embarked'</span>]=train[<span class="string">'Embarked'</span>].fillna(<span class="string">'S'</span>)</span><br><span class="line"><span class="built_in">print</span>( train[[<span class="string">'Embarked'</span>, <span class="string">'Survived'</span>]].groupby([<span class="string">'Embarked'</span>], as_index=False).mean() )</span><br><span class="line"></span><br><span class="line">Embarked  Survived</span><br><span class="line">0        C  0.553571</span><br><span class="line">1        Q  0.389610</span><br><span class="line">2        S  0.339009</span><br></pre></td></tr></table></figure></p>
<h2 id="4-特征转化"><a href="#4-特征转化" class="headerlink" title="4.特征转化"></a>4.特征转化</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Sex</span></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">     dataset[<span class="string">'Sex'</span>] = dataset[<span class="string">'Sex'</span>].map( &#123;<span class="string">'female'</span>: 0, <span class="string">'male'</span>: 1&#125; ).astype(int)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Title</span></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    title_mapping = &#123;<span class="string">"Mr"</span>: 1, <span class="string">"Miss"</span>: 2, <span class="string">"Mrs"</span>: 3, <span class="string">"Master"</span>: 4, <span class="string">"Rare"</span>: 5&#125;</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].map(title_mapping)</span><br><span class="line">    dataset[<span class="string">'Title'</span>] = dataset[<span class="string">'Title'</span>].fillna(0)  </span><br><span class="line"><span class="comment">#登船口</span></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset[<span class="string">'Embarked'</span>] = dataset[<span class="string">'Embarked'</span>].map( &#123;<span class="string">'S'</span>: 0, <span class="string">'C'</span>: 1, <span class="string">'Q'</span>: 2&#125; ).astype(int)  </span><br><span class="line"><span class="comment">#票价</span></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:</span><br><span class="line">    dataset.loc[dataset[<span class="string">'Fare'</span>]&lt;=7.91,<span class="string">'Fare'</span>]                                   = 0</span><br><span class="line">    dataset.loc[(dataset[<span class="string">'Fare'</span>] &gt; 7.91) &amp; (dataset[<span class="string">'Fare'</span>] &lt;= 14.454),<span class="string">'Fare'</span>]  = 1</span><br><span class="line">    dataset.loc[(dataset[<span class="string">'Fare'</span>] &gt; 14.454) &amp; (dataset[<span class="string">'Fare'</span>] &lt;= 31), <span class="string">'Fare'</span>]   = 2</span><br><span class="line">    dataset.loc[ dataset[<span class="string">'Fare'</span>] &gt; 31, <span class="string">'Fare'</span>]        = 3</span><br><span class="line">    dataset[<span class="string">'Fare'</span>] = dataset[<span class="string">'Fare'</span>].astype(int)</span><br><span class="line"><span class="comment">#年龄</span></span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> full_data:    </span><br><span class="line">    dataset.loc[ dataset[<span class="string">'Age'</span>] &lt;= 16, <span class="string">'Age'</span>]        = 0</span><br><span class="line">    dataset.loc[(dataset[<span class="string">'Age'</span>] &gt; 16) &amp; (dataset[<span class="string">'Age'</span>] &lt;= 32), <span class="string">'Age'</span>] = 1</span><br><span class="line">    dataset.loc[(dataset[<span class="string">'Age'</span>] &gt; 32) &amp; (dataset[<span class="string">'Age'</span>] &lt;= 48), <span class="string">'Age'</span>] = 2</span><br><span class="line">    dataset.loc[(dataset[<span class="string">'Age'</span>] &gt; 48) &amp; (dataset[<span class="string">'Age'</span>] &lt;= 64), <span class="string">'Age'</span>] = 3</span><br><span class="line">    dataset.loc[ dataset[<span class="string">'Age'</span>] &gt; 64, <span class="string">'Age'</span>]                           = 4</span><br></pre></td></tr></table></figure>
<p>去掉不要的特征<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">drop_elements = [<span class="string">'PassengerId'</span>, <span class="string">'Name'</span>, <span class="string">'Ticket'</span>, <span class="string">'Cabin'</span>, <span class="string">'SibSp'</span>,<span class="string">'Parch'</span>, <span class="string">'FamilySize'</span>]</span><br><span class="line">train = train.drop(drop_elements, axis = 1)</span><br><span class="line">train = train.drop([<span class="string">'CategoricalAge'</span>, <span class="string">'CategoricalFare'</span>], axis = 1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span>  = test.drop(drop_elements, axis = 1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (train.head(10))</span><br><span class="line"></span><br><span class="line">train = train.values</span><br><span class="line"><span class="built_in">test</span>  = test.values</span><br></pre></td></tr></table></figure></p>
<h2 id="5-模型选择"><a href="#5-模型选择" class="headerlink" title="5.模型选择"></a>5.模型选择</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">classifiers = [</span><br><span class="line">    KNeighborsClassifier(3),</span><br><span class="line">    SVC(probability=True),</span><br><span class="line">    DecisionTreeClassifier(),</span><br><span class="line">    RandomForestClassifier(),</span><br><span class="line">    AdaBoostClassifier(),</span><br><span class="line">    GradientBoostingClassifier(),</span><br><span class="line">    GaussianNB(),</span><br><span class="line">    LinearDiscriminantAnalysis(),</span><br><span class="line">    QuadraticDiscriminantAnalysis(),</span><br><span class="line">    LogisticRegression()]</span><br><span class="line"></span><br><span class="line">log_cols = [<span class="string">"Classifier"</span>, <span class="string">"Accuracy"</span>]</span><br><span class="line"><span class="built_in">log</span>  = pd.DataFrame(columns=log_cols)</span><br><span class="line"></span><br><span class="line">sss = StratifiedShuffleSplit(n_splits=10, test_size=0.1, random_state=0)</span><br><span class="line"></span><br><span class="line">X = train[0::, 1::]</span><br><span class="line">y = train[0::, 0]</span><br><span class="line"></span><br><span class="line">name_list=[]</span><br><span class="line">cv_scores_mean = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> train_index, test_index <span class="keyword">in</span> sss.split(X, y):</span><br><span class="line">    X_train, X_test = X[train_index], X[test_index]</span><br><span class="line">    y_train, y_test = y[train_index], y[test_index]</span><br><span class="line"></span><br><span class="line">from sklearn.model_selection import cross_val_score</span><br><span class="line"><span class="keyword">for</span> clf <span class="keyword">in</span> classifiers:</span><br><span class="line">        clf_name = clf.__class__.__name__</span><br><span class="line">        name_list.append(clf_name)</span><br><span class="line">        cv_scores =cross_val_score(clf,X_train,y_train,cv=3)</span><br><span class="line">        cv_scores_mean.append(cv_scores.mean())</span><br><span class="line"></span><br><span class="line">log_entry = pd.DataFrame(&#123;<span class="string">"Classifier"</span> : name_list,<span class="string">"cv_scores_mean"</span> : cv_scores_mean&#125;)</span><br><span class="line"><span class="built_in">print</span>(log_entry.sort_values(by=<span class="string">'cv_scores_mean'</span>,ascending=False))</span><br><span class="line"></span><br><span class="line">Classifier  cv_scores_mean</span><br><span class="line">1                            SVC        0.824463</span><br><span class="line">8  QuadraticDiscriminantAnalysis        0.807615</span><br><span class="line">5     GradientBoostingClassifier        0.804796</span><br><span class="line">9             LogisticRegression        0.803419</span><br><span class="line">0           KNeighborsClassifier        0.801971</span><br><span class="line">3         RandomForestClassifier        0.797740</span><br><span class="line">7     LinearDiscriminantAnalysis        0.796399</span><br><span class="line">2         DecisionTreeClassifier        0.792114</span><br><span class="line">6                     GaussianNB        0.786565</span><br><span class="line">4             AdaBoostClassifier        0.783729</span><br></pre></td></tr></table></figure>
<p>模型评分图</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel(<span class="string">'Accuracy'</span>)</span><br><span class="line">plt.title(<span class="string">'Classifier Accuracy'</span>)</span><br><span class="line"></span><br><span class="line">sns.set_color_codes(<span class="string">"muted"</span>)</span><br><span class="line">sns.barplot(x=<span class="string">'Accuracy'</span>, y=<span class="string">'Classifier'</span>, data=<span class="built_in">log</span>, color=<span class="string">"b"</span>)</span><br></pre></td></tr></table></figure>
<img src="/2018/04/19/Titanic_1/model.png" title="This is an example image">
<h2 id="6-预测并提交"><a href="#6-预测并提交" class="headerlink" title="6.预测并提交"></a>6.预测并提交</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">candidate_classifier = SVC()</span><br><span class="line">candidate_classifier.fit(train[0:, 1:], train[0:, 0])</span><br><span class="line">result = candidate_classifier.predict(<span class="built_in">test</span>)</span><br><span class="line">submission = pd.DataFrame(&#123;<span class="string">"PassengerId"</span>:PassengerId ,<span class="string">"Survived"</span>: result&#125;)</span><br><span class="line">submission.to_csv(<span class="string">'submission.csv'</span>, index=False)</span><br></pre></td></tr></table></figure>
<h2 id="7-填补缺失值的其他方法"><a href="#7-填补缺失值的其他方法" class="headerlink" title="7.填补缺失值的其他方法"></a>7.填补缺失值的其他方法</h2><ul>
<li>Embarked feature:<br>Embarked缺失量为2，缺失Embarked信息的乘客的Pclass均为1，且Fare均为80，因为Embarked为C且Pclass为1的乘客的Fare中位数为80，所以缺失值填充为C。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[&quot;Embarked&quot;] = dataset[&quot;Embarked&quot;].fillna(&quot;C&quot;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>观察过程如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train[train[&apos;Embarked&apos;].isnull()] ##找出缺失的样本</span><br></pre></td></tr></table></figure>
<img src="/2018/04/19/Titanic_1/Embarked-missing-val.png" title="This is an example image">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sns.boxplot(x=&apos;Embarked&apos;,y=&apos;Fare&apos;,hue=&apos;Pclass&apos;, data=dataset)</span><br></pre></td></tr></table></figure>
<img src="/2018/04/19/Titanic_1/Embarked-mv.png" title="This is an example image">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">dataset[(dataset[&apos;Pclass&apos;]==1) &amp; (dataset[&apos;Embarked&apos;]==&apos;C&apos;)].median()</span><br><span class="line"></span><br><span class="line">Age             39.0000</span><br><span class="line">Fare            76.7292</span><br><span class="line">Parch            0.0000</span><br><span class="line">PassengerId    699.0000</span><br><span class="line">Pclass           1.0000</span><br><span class="line">SibSp            0.0000</span><br><span class="line">Survived         1.0000</span><br><span class="line"></span><br><span class="line">dataset[(dataset[&apos;Pclass&apos;]==1) &amp; (dataset[&apos;Embarked&apos;]==&apos;S&apos;)].median()</span><br><span class="line">Age             39.0</span><br><span class="line">Fare            52.0</span><br><span class="line">Parch            0.0</span><br><span class="line">PassengerId    666.5</span><br><span class="line">Pclass           1.0</span><br><span class="line">SibSp            0.0</span><br><span class="line">Survived         1.0</span><br><span class="line"></span><br><span class="line">dataset[(dataset[&apos;Pclass&apos;]==1) &amp; (dataset[&apos;Embarked&apos;]==&apos;Q&apos;)].median()</span><br><span class="line">Age               37.0</span><br><span class="line">Fare              90.0</span><br><span class="line">Parch              0.0</span><br><span class="line">PassengerId      413.0</span><br><span class="line">Pclass             1.0</span><br><span class="line">SibSp              1.0</span><br><span class="line">Survived           0.5</span><br><span class="line">Ticket         19928.0</span><br></pre></td></tr></table></figure>
<ul>
<li>Fare Feature：<br>Fare缺失量为1，缺失Fare信息的乘客的Embarked为S，Pclass为3，所以用Embarked为S，Pclass为3的乘客的Fare中位数填充。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset[dataset[&apos;Fare&apos;].isnull()]</span><br></pre></td></tr></table></figure>
<img src="/2018/04/19/Titanic_1/fare-missing-val.png" title="This is an example image">
<ul>
<li>找到Embarked为S，Pclass为3的乘客的Fare中位数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fare=dataset[(dataset[&apos;Pclass&apos;]==3) &amp; (dataset[&apos;Embarked&apos;]==&apos;S&apos;)].Fare.median()</span><br><span class="line">dataset[&apos;Fare&apos;]=dataset[&apos;Fare&apos;].fillna(fare)</span><br></pre></td></tr></table></figure>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 valine -->
<div id="comment">
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '#comment' ,
        notify: true,
        verify: false,
        app_id: '5ieD2qBIigoLuVa78tzFJ22P-gzGzoHsz',
        app_key: '6TREdEvvBJpk2ElJDUL27w5U',
        placeholder: 'Please leave your footprints',
        pageSize: '10',
        avatar: '',
        avatar_cdn: 'https://gravatar.loli.net/avatar/'
    });
</script>
</div>
<style>
   #comment{
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
